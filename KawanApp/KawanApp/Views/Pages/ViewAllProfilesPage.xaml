<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:d="http://xamarin.com/schemas/2014/forms/design"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:converters="clr-namespace:KawanApp.Converters"
             xmlns:ffimageloading="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms"
             mc:Ignorable="d"
             x:Class="KawanApp.Views.Pages.ViewAllProfilesPage">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:NameFormatConverter x:Key="NameFormat" />
            <converters:ProfileImageConverter x:Key="ImageFormat" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Content>
        <StackLayout>
            <Label 
                Text="Kawan"
                HorizontalOptions="Center"
                FontSize="Large"
                FontAttributes="Bold"
                Margin="0,10"/>
            <BoxView 
                HeightRequest="1"
                HorizontalOptions="FillAndExpand"
                Color="LightGray"/>
            
            <!--#region Top Menu -->
            <StackLayout 
                Orientation="Horizontal" 
                Margin="20,5"
                VerticalOptions="Center">
                <Image
                    Source="location.png"
                    WidthRequest="20"
                    HeightRequest="20"/>
                <Label
                    Text="Location"/>
                <!--Empty label included to have an unclickable fill between the location and refine constructs-->
                <Label
                    HorizontalOptions="FillAndExpand"/>
                <Image
                    Source="refine.png"
                    WidthRequest="20"
                    HeightRequest="20"/>
                <Label
                    Text="Refine"/>
            </StackLayout>
            <BoxView 
                HeightRequest="1"
                HorizontalOptions="FillAndExpand"
                Color="LightGray"/>
            <!--#endregion-->
            
            <!--#region List of Profiles-->
            <ListView 
                ItemsSource="{Binding AllKawanUsers}" 
                RowHeight="110"
                IsPullToRefreshEnabled="True"
                RefreshCommand="{Binding RefreshCommand}"
                IsRefreshing="{Binding IsRefreshing}"
                ItemTapped="KawanList_ItemTapped">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <StackLayout 
                                Orientation="Horizontal" 
                                VerticalOptions="Center" 
                                HorizontalOptions="FillAndExpand" 
                                Margin="20,0">
                                <Frame 
                                    CornerRadius="90" 
                                    Padding="0"
                                    IsClippedToBounds="True"
                                    HasShadow="True"
                                    BackgroundColor="#581059"
                                    WidthRequest="80"
                                    HeightRequest="80">
                                    <ffimageloading:CachedImage 
                                        Source="{Binding Pic, Converter={StaticResource ImageFormat}}"
                                        ErrorPlaceholder="profileplaceholder.png"
                                        Transformations="{Binding Transformations}"
                                        CacheType="Disk"/>
                                </Frame>
                                <StackLayout 
                                    Orientation="Vertical"
                                    HorizontalOptions="FillAndExpand"
                                    Margin="5,0,0,0">
                                    <StackLayout 
                                        Orientation="Horizontal">
                                        <Label 
                                            Text="{Binding FullName, Converter={StaticResource NameFormat}}" 
                                            FontSize="Medium"
                                            FontAttributes="Bold"
                                            HorizontalOptions="FillAndExpand"/>
                                        <!--Insert converter to determine if the icon to display is send message or add friend-->
                                        <Image
                                            Source="addFriend.png"
                                            HeightRequest="28" 
                                            WidthRequest="28">
                                            <Image.GestureRecognizers>
                                                <TapGestureRecognizer
                                                    Tapped="Icon_Tapped"
                                                    NumberOfTapsRequired="1"/>
                                            </Image.GestureRecognizers>
                                        </Image>
                                    </StackLayout>
                                    <Label 
                                        Text="/{Insert Rating Here}"/>
                                    <!--Implement converter and behaviour to determine how many stars need to be filled based on rating-->
                                    <StackLayout 
                                        Orientation="Horizontal">
                                        <Label 
                                            Text="{Binding Country}" 
                                            HorizontalOptions="FillAndExpand"/>
                                        <Image
                                            Source="messageTime.png"
                                            HeightRequest="20" 
                                            WidthRequest="20"/>
                                        <Label>
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="{Binding AverageResponseTime}"/>
                                                    <!--Implement converter to convert time span to mins or hours-->
                                                    <Span Text=" mins"/>
                                                    <!--Implement converter to determine min, mins, hr, hrs-->
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </StackLayout>
                                </StackLayout>
                            </StackLayout>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
            <!--#endregion-->
            
        </StackLayout>
    </ContentPage.Content>
</ContentPage>